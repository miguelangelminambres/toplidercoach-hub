<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TopLiderCoach HUB</title>

    <!-- Librer√≠as externas -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://toplidercoach.com/config.js"></script>

    <!-- CSS Modular -->
    <link rel="stylesheet" href="css/core.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/planificador.css">
    <link rel="stylesheet" href="css/matchstats.css">
    <link rel="stylesheet" href="css/analisis.css">
    <link rel="stylesheet" href="css/staff.css">
    <link rel="stylesheet" href="css/miclub.css">
    <link rel="stylesheet" href="css/asistencia.css">
</head>
<body>
    <!-- ==================== LOGIN ==================== -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>HUB TopLiderCoach</h1>
                <p>Plataforma integral para entrenadores</p>
            </div>
            <div id="login-error" class="login-error"></div>
            <input type="text" id="username" placeholder="Usuario o email">
            <input type="password" id="password" placeholder="Contrasena">
            <button onclick="login()">Iniciar Sesion</button>
        </div>
    </div>
    
    <!-- ==================== APP ==================== -->
    <div id="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-brand">
    <img src="https://toplidercoach.com/wp-content/uploads/2025/11/diseno-sin-titulo-11.png" alt="TopLiderCoach" class="header-logo">
    <h1>HUB TopLiderCoach</h1>
</div>
            <div class="header-right">
                <div class="club-badge" id="club-badge">
                    <div class="club-initial" id="club-initial">?</div>
                    <span id="club-nombre-header">Mi Club</span>
                </div>
                <div class="user-info">
                    <span class="user-name" id="user-name"></span>
                    <button class="btn-logout" onclick="logout()">Salir</button>
                </div>
            </div>
        </header>
        
       <!-- Tabs Principales -->
<div class="main-tabs">
    <button class="main-tab dashboard active" onclick="cambiarModulo('dashboard', this)">
        üìä Dashboard
    </button>
    <button class="main-tab planificador" onclick="cambiarModulo('planificador', this)">
        Planificador
    </button>
    <button class="main-tab matchstats" onclick="cambiarModulo('matchstats', this)">
        MatchStats
    </button>
    <button class="main-tab staff" onclick="cambiarModulo('staff', this)">
        Tu Cuerpo T√©cnico
    </button>
    <button class="main-tab config" onclick="cambiarModulo('config', this)">
        Mi Club
    </button>
</div>
      <!-- ==================== MODULO: DASHBOARD ==================== -->
<div id="modulo-dashboard" class="vista-modulo active">
    <div class="dashboard-container">
        
        <!-- HERO BANNER -->
        <div class="dash-hero">
            <div class="dash-hero-left">
                <div class="dash-hero-club">
                    <div class="dash-hero-logo" id="dash-club-logo"></div>
                    <div>
                        <h2 id="dash-club-name">Mi Equipo</h2>
                        <div class="dash-hero-season">
                            <select id="dashboard-temporada" onchange="cargarDashboard()">
                                <option value="">Todas</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dash-hero-stats" id="dash-hero-stats">
                <div class="dash-hs"><span class="dash-hs-val" id="dh-pj">0</span><span class="dash-hs-lbl">PJ</span></div>
                <div class="dash-hs win"><span class="dash-hs-val" id="dh-v">0</span><span class="dash-hs-lbl">VIC</span></div>
                <div class="dash-hs draw"><span class="dash-hs-val" id="dh-e">0</span><span class="dash-hs-lbl">EMP</span></div>
                <div class="dash-hs loss"><span class="dash-hs-val" id="dh-d">0</span><span class="dash-hs-lbl">DER</span></div>
                <div class="dash-hs gf"><span class="dash-hs-val" id="dh-gf">0</span><span class="dash-hs-lbl">GF</span></div>
                <div class="dash-hs gc"><span class="dash-hs-val" id="dh-gc">0</span><span class="dash-hs-lbl">GC</span></div>
                <div class="dash-hs dif"><span class="dash-hs-val" id="dh-dif">+0</span><span class="dash-hs-lbl">DIF</span></div>
                <div class="dash-hs pct"><span class="dash-hs-val" id="dh-pct">0%</span><span class="dash-hs-lbl">VICTORIAS</span></div>
            </div>
        </div>
        
        <!-- TOP PERFORMERS -->
        <div class="dash-performers" id="dash-performers">
            <div class="dash-perf-title">‚≠ê Destacados de la Temporada</div>
            <div class="dash-perf-grid" id="dash-perf-grid">
                <!-- Generated dynamically -->
            </div>
        </div>
        
        <!-- MAIN GRID -->
        <div class="dash-main-grid">
            
            <!-- COL LEFT -->
            <div class="dash-col">
                <!-- √öltimos Partidos -->
                <div class="dash-card">
                    <div class="dash-card-head">
                        <h3>‚öΩ Partidos</h3>
                    </div>
                    <div class="dash-card-body">
                        <div class="ultimos-partidos" id="dash-ultimos-partidos">
                            <div class="sin-datos"><div class="icono">‚öΩ</div><p>Cargando...</p></div>
                        </div>
                    </div>
                </div>
                
                <!-- Pr√≥ximos Eventos -->
                <div class="dash-card">
                    <div class="dash-card-head">
                        <h3>üìÖ Pr√≥ximos Eventos</h3>
                    </div>
                    <div class="dash-card-body">
                        <div class="proximos-eventos" id="dash-proximos-eventos">
                            <div class="sin-datos"><div class="icono">üìÖ</div><p>Cargando...</p></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- COL RIGHT -->
            <div class="dash-col">
                <!-- Distribuci√≥n Resultados -->
                <div class="dash-card">
                    <div class="dash-card-head">
                        <h3>üìà Distribuci√≥n de Resultados</h3>
                    </div>
                    <div class="dash-card-body">
                        <div class="resultados-multi">
                            <div class="resultado-donut principal">
                                <canvas id="chart-resultados-total"></canvas>
                                <div class="donut-label">Total</div>
                                <div class="donut-stats" id="stats-total"></div>
                            </div>
                            <div class="resultados-competiciones" id="donuts-competiciones"></div>
                        </div>
                        <div class="chart-legend resultados-legend">
                            <div class="legend-item"><div class="legend-color victoria"></div><span>Victoria</span></div>
                            <div class="legend-item"><div class="legend-color empate"></div><span>Empate</span></div>
                            <div class="legend-item"><div class="legend-color derrota"></div><span>Derrota</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Goles -->
                <div class="dash-card">
                    <div class="dash-card-head">
                        <h3>ü•Ö Goles a Favor vs En Contra</h3>
                    </div>
                    <div class="dash-card-body">
                        <div class="chart-container"><canvas id="chart-goles"></canvas></div>
                        <div style="text-align:center;margin-top:10px;">
                            <span style="font-size:14px;color:#6b7280;">Diferencia: </span>
                            <span id="dash-diferencia-goles" style="font-size:18px;font-weight:700;">+0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- BOTTOM ROW -->
        <div class="dash-bottom-grid">
            <!-- Entrenamientos del mes -->
            <div class="dash-card">
                <div class="dash-card-head">
                    <h3>üèÉ Entrenamientos del Mes</h3>
                </div>
                <div class="dash-card-body">
                    <div class="dash-train-stats">
                        <div class="dash-train-stat"><span class="dash-train-val" id="dash-sesiones">-</span><span class="dash-train-lbl">Sesiones</span></div>
                        <div class="dash-train-stat"><span class="dash-train-val" id="dash-asistencia-media">-</span><span class="dash-train-lbl">Asistencia</span></div>
                        <div class="dash-train-stat"><span class="dash-train-val" id="dash-wellness-medio">-</span><span class="dash-train-lbl">Wellness</span></div>
                    </div>
                </div>
            </div>
            
            <!-- Estado Plantilla -->
            <div class="dash-card">
                <div class="dash-card-head">
                    <h3>üè• Estado Plantilla</h3>
                </div>
                <div class="dash-card-body">
                    <div id="dash-squad-status">
                        <div class="sin-datos"><div class="icono">‚úÖ</div><p>Cargando...</p></div>
                    </div>
                </div>
            </div>
            
            <!-- Alertas Bienestar -->
            <div class="dash-card">
                <div class="dash-card-head">
                    <h3>‚ö†Ô∏è Alertas Bienestar</h3>
                </div>
                <div class="dash-card-body">
                    <div class="alertas-wellness" id="dash-alertas-wellness">
                        <div class="sin-datos"><div class="icono">‚úÖ</div><p>Cargando...</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>  
        <!-- ==================== MODULO: PLANIFICADOR ==================== -->
        <div id="modulo-planificador" class="vista-modulo">
            <div class="sub-tabs planificador-subtabs">
                <button class="sub-tab active" onclick="cambiarSubTab('planificador', 'crear', this)">Crear Sesion</button>
                <button class="sub-tab" onclick="cambiarSubTab('planificador', 'mis-sesiones', this)">Mis Sesiones</button>
                <button class="sub-tab" onclick="cambiarSubTab('planificador', 'calendario', this)">Calendario</button>
                <button class="sub-tab" onclick="cambiarSubTab('planificador', 'asistencia', this)">üìä Asistencia</button>
            </div>
            
            <!-- Sub: Crear Sesi√≥n -->
            <div id="planificador-crear" class="vista-contenido active">
                <div class="section-header">
                    <h2>Crear Nueva Sesion</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-secondary" onclick="limpiarSesion()">Nueva Sesion</button>
                        <button class="btn-primary purple" onclick="guardarSesion()">Guardar Sesion</button>
                    </div>
                </div>
                
                <!-- Info de la sesi√≥n -->
               <!-- Info de la sesi√≥n -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-body">
                        <!-- Toggle Info General -->
                        <button class="info-sesion-toggle" onclick="toggleInfoSesion()">
                            <span>Informacion de la Sesion</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        
                        <!-- Campos Info General -->
                        <div class="sesion-info-grid" id="sesion-info-grid">
                            <div class="campo-grupo full-width">
                                <label>Nombre de la Sesion *</label>
                                <input type="text" id="sesion-nombre" placeholder="Ej: Posesion y finalizacion">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>Fecha</label>
                                <input type="date" id="sesion-fecha">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>Hora de Inicio</label>
                                <input type="time" id="sesion-hora">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>Microciclo</label>
                                <input type="text" id="sesion-microciclo" placeholder="Ej: M1, M2...">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>MD (Match Day)</label>
                                <input type="text" id="sesion-md" placeholder="Ej: MD-2, MD+1...">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>Num Jugadores</label>
                                <input type="number" id="sesion-jugadores" placeholder="Ej: 20" min="1">
                            </div>
                            
                            <div class="campo-grupo">
                                <label>Equipo / Categoria</label>
                                <input type="text" id="sesion-equipo" placeholder="Ej: Juvenil A">
                            </div>
                            
                            <div class="campo-grupo full-width">
                                <label>Objetivo de la Sesion</label>
                                <textarea id="sesion-objetivo" placeholder="Ej: Mejorar la presion alta y transiciones"></textarea>
                            </div>
                            
                            <div class="campo-grupo full-width">
                                <label>Material Necesario</label>
                                <textarea id="sesion-material" placeholder="Ej: 20 conos, 10 petos, 2 porterias..."></textarea>
                            </div>
                            
                            <div class="campo-grupo full-width">
                                <label>Notas Generales</label>
                                <textarea id="sesion-notas" placeholder="Observaciones, condiciones climaticas, etc."></textarea>
                            </div>
                        </div>
                        <!-- Selector de Jugadores -->
                        <div class="jugadores-selector">
                            <div class="jugadores-selector-header">
                                <h4>Jugadores aptos para entrenar</h4>
                                <div>
                                    <span class="contador" id="contador-jugadores">0 seleccionados</span>
                                    <button type="button" class="btn-seleccionar-todos" onclick="toggleTodosJugadores()">Todos</button>
                                </div>
                            </div>
                            <div class="jugadores-sesion-grid" id="jugadores-sesion-grid">                                <p style="color:#9ca3af;font-size:12px;grid-column:1/-1;text-align:center;">Cargando jugadores...</p>
                            </div>
                        </div>
                        <!-- Duracion Total -->
                        <div class="duracion-total-display">
                            <span class="label">Duracion Total:</span>
                            <span class="tiempo" id="duracion-total">0 min</span>
                        </div>
                    </div>
                </div>
                
                <!-- Layout del planificador -->
                <div class="planificador-layout">
                  <!-- Panel Biblioteca -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Biblioteca de Ejercicios</h3>
                        </div>
                        <div class="panel-content">
                            <!-- Toggle Filtros -->
                       <!-- Toggle Filtros -->
                            <div class="filtros-toggle collapsed" onclick="toggleFiltros()" id="filtros-toggle">
                                <h4>Filtros Avanzados</h4>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            
                            <!-- Filtros (colapsados por defecto) -->
                            <div class="filtros-biblioteca collapsed" id="filtros-biblioteca">
                                <input type="text" id="filtro-buscar" placeholder="Buscar por nombre...">
                                <select id="filtro-entrenador">
                                    <option value="">Entrenador</option>
                                </select>
                                <select id="filtro-equipo">
                                    <option value="">Equipo</option>
                                </select>
                                <select id="filtro-tema">
                                    <option value="">Tema</option>
                                </select>
                                <select id="filtro-dificultad">
                                    <option value="">Dificultad</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                                <div class="filtros-botones">
                                    <button class="btn-filtrar" onclick="cargarEjercicios(1)">Filtrar</button>
                                    <button class="btn-limpiar-filtros" onclick="limpiarFiltros()">Limpiar</button>
                                </div>
                            </div>
                            <div id="lista-ejercicios">
                                <div class="loading">Cargando ejercicios...</div>
                            </div>
                            <div id="paginacion-ejercicios" style="text-align: center; margin-top: 15px;"></div>
                        </div>
                    </div>
                    
                    <!-- Panel Sesi√≥n -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Mi Sesion</h3>
                        </div>
                        <div class="panel-content">
                            <!-- Calentamiento -->
                            <div class="seccion-ejercicios">
                                <div class="seccion-header calentamiento">
                                    <span>Calentamiento</span>
                                    <span id="tiempo-calentamiento">0 min</span>
                                </div>
                                <div id="lista-calentamiento"></div>
                            </div>
                            
                            <!-- Principal -->
                            <div class="seccion-ejercicios">
                                <div class="seccion-header principal">
                                    <span>Parte Principal</span>
                                    <span id="tiempo-principal">0 min</span>
                                </div>
                                <div id="lista-principal"></div>
                            </div>
                            
                            <!-- Enfriamiento -->
                            <div class="seccion-ejercicios">
                                <div class="seccion-header enfriamiento">
                                    <span>Enfriamiento</span>
                                    <span id="tiempo-enfriamiento">0 min</span>
                                </div>
                                <div id="lista-enfriamiento"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Panel Detalles -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Detalles</h3>
                        </div>
                        <div class="panel-content">
                            <div id="detalle-ejercicio" class="detalle-ejercicio">
                                <p>Selecciona un ejercicio para ver sus detalles</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sub: Mis Sesiones -->
            <div id="planificador-mis-sesiones" class="vista-contenido">
                <div class="section-header">
                    <h2>Mis Sesiones Guardadas</h2>
                    <button class="btn-secondary" onclick="cargarMisSesiones()">Actualizar</button>
                </div>
                
                <div class="filtros-bar">
                    <div class="filtro-grupo">
                        <label>Desde:</label>
                        <input type="date" id="filtro-sesion-desde">
                    </div>
                    <div class="filtro-grupo">
                        <label>Hasta:</label>
                        <input type="date" id="filtro-sesion-hasta">
                    </div>
                    <button class="btn-primary" onclick="cargarMisSesiones()">Filtrar</button>
                    <button class="btn-secondary" onclick="limpiarFiltroSesiones()">Limpiar</button>
                </div>
                
                <div id="lista-mis-sesiones" class="grid-cards">
                    <div class="loading">Cargando sesiones...</div>
                </div>
            </div>
            <!-- Sub: Asistencia -->
<div id="planificador-asistencia" class="vista-contenido">
    <div class="section-header">
        <h2>üìä Control de Asistencia</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
            <select id="asistencia-mes" onchange="cargarAsistenciaMes()">
                <option value="">Selecciona mes...</option>
            </select>
            <button class="btn-primary purple" onclick="cargarAsistenciaMes()">üîÑ Actualizar</button>
        </div>
    </div>
    
    <!-- Resumen del mes -->
    <div class="asistencia-resumen" id="asistencia-resumen">
        <div class="asistencia-stat">
            <span class="numero" id="asistencia-total-sesiones">0</span>
            <span class="label">Sesiones del mes</span>
        </div>
        <div class="asistencia-stat">
            <span class="numero" id="asistencia-promedio">0%</span>
            <span class="label">Asistencia media</span>
        </div>
    </div>
    
    <!-- Tabla de jugadores -->
    <div class="card">
        <div class="card-header">
            <h3>Asistencia por Jugador</h3>
        </div>
        <div class="card-body" style="overflow-x: auto;">
            <table class="stats-tabla asistencia-tabla">
                <thead>
                    <tr>
                        <th>Jugador</th>
                        <th>Sesiones</th>
                        <th>Asistencias</th>
                        <th>%</th>
                        <th>Peso Prom.</th>
                        <th>Wellness Prom.</th>
                        <th>Muscular Prom.</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="asistencia-tabla-body">
                    <tr><td colspan="8" style="text-align:center; color:#9ca3af;">Selecciona un mes para ver datos</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
            <!-- Sub: Calendario Unificado -->
            <div id="planificador-calendario" class="vista-contenido">
                <div class="calendario-container">
                    <div class="calendario-header">
                        <h2>üìÖ Calendario</h2>
                        <div class="calendario-nav">
                            <button onclick="mesAnteriorCalendario()">‚óÄ</button>
                            <span class="mes-actual" id="mes-actual-calendario">Febrero 2026</span>
                            <button onclick="mesSiguienteCalendario()">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="calendario-leyenda-unificada">
                        <span class="leyenda-item"><span class="leyenda-dot sesion"></span> Sesi√≥n</span>
                        <span class="leyenda-item"><span class="leyenda-dot victoria"></span> Victoria</span>
                        <span class="leyenda-item"><span class="leyenda-dot empate"></span> Empate</span>
                        <span class="leyenda-item"><span class="leyenda-dot derrota"></span> Derrota</span>
                        <span class="leyenda-item"><span class="leyenda-dot pendiente"></span> Pendiente</span>
                    </div>
                    <div class="calendario-grid" id="calendario-unificado">
                        <!-- Se genera din√°micamente -->
                    </div>
                    <div class="calendario-resumen-unificado" id="calendario-resumen">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== MODULO: MATCHSTATS ==================== -->
        <div id="modulo-matchstats" class="vista-modulo">
          <div class="sub-tabs matchstats-subtabs">
    <button class="sub-tab active" onclick="cambiarSubTab('matchstats', 'partidos', this)">Partidos</button>
    <button class="sub-tab" onclick="cambiarSubTab('matchstats', 'estadisticas', this)">Estad√≠sticas</button>
    <button class="sub-tab" onclick="cambiarSubTab('matchstats', 'analisis', this)">üìä An√°lisis</button>
</div>
            
            <!-- Sub: Partidos -->
            <div id="matchstats-partidos" class="vista-contenido active">
                <div class="section-header">
                    <h2>Partidos</h2>
                    <button class="btn-primary green" onclick="abrirModalPartido()">+ Nuevo Partido</button>
                </div>
                
              <div class="filtros-bar">
    <div class="filtro-grupo">
        <label>Desde:</label>
        <input type="date" id="filtro-partido-desde">
    </div>
    <div class="filtro-grupo">
        <label>Hasta:</label>
        <input type="date" id="filtro-partido-hasta">
    </div>
    <button class="btn-primary green" onclick="cargarPartidos()" style="padding: 8px 16px;">Filtrar</button>
    <button class="btn-secondary" onclick="limpiarFiltroPartidos()" style="padding: 8px 16px;">Limpiar</button>
    <div style="border-left: 2px solid #e5e7eb; height: 30px; margin: 0 10px;"></div>
    <button class="filtro-btn active" onclick="filtrarPartidos('todos', this)">Todos</button>
    <button class="filtro-btn" onclick="filtrarPartidos('proximos', this)">Pr√≥ximos</button>
    <button class="filtro-btn" onclick="filtrarPartidos('jugados', this)">Jugados</button>
</div>
                
                <div id="lista-partidos" class="grid-cards">
                    <div class="loading">Cargando partidos...</div>
                </div>
            </div>
            
            <!-- Sub: Estad√≠sticas -->
            <div id="matchstats-estadisticas" class="vista-contenido">
                <div class="section-header">
                    <h2>Estadisticas de Temporada</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="stats-temporada" onchange="cargarEstadisticas()"></select>
                        <button class="btn-primary" onclick="exportarEstadisticasPDF()">Exportar PDF</button>
                    </div>
                </div>
                
                <div class="stats-resumen" id="stats-resumen">
                    <!-- Se genera din√°micamente -->
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Estadisticas por Jugador</h3>
                    </div>
                    <div class="card-body" style="overflow-x: auto;">
                        <table class="stats-tabla">
                            <thead>
                                <tr>
                                    <th>Jugador</th>
                                    <th>PJ</th>
                                    <th>Min</th>
                                    <th>Goles</th>
                                    <th>Asist.</th>
                                    <th>TA</th>
                                    <th>TR</th>
                                </tr>
                            </thead>
                            <tbody id="stats-tabla-body">
                                <!-- Se genera din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
<!-- Sub: An√°lisis de Partidos -->
<div id="matchstats-analisis" class="vista-contenido">
    <div class="analisis-container">
        
        <!-- Selector de partido -->
        <div class="analisis-header">
            <h2>üìä An√°lisis de Partido</h2>
            <div class="analisis-selector">
                <label>Selecciona partido:</label>
                <select id="analisis-partido-select" onchange="cargarAnalisisPartido()">
                    <option value="">-- Elige un partido jugado --</option>
                </select>
            </div>
        </div>

        <!-- Contenido del an√°lisis (se muestra al seleccionar partido) -->
        <div id="analisis-contenido" style="display: none;">
            
            <!-- Info del partido seleccionado -->
            <div class="analisis-partido-info" id="analisis-partido-info"></div>

            <!-- Gesti√≥n del rival -->
            <div class="analisis-seccion rival-header">
                <div class="rival-badge">
                    <img id="rival-logo-preview" src="" alt="Escudo rival" style="display:none;">
                    <div id="rival-logo-placeholder" class="logo-placeholder">üõ°Ô∏è</div>
                </div>
                <div class="rival-info">
                    <h3 id="rival-nombre">Rival</h3>
                    <input type="file" id="rival-logo-input" accept="image/*" onchange="subirLogoRival()" style="display:none;">
                    <button class="btn-subir-logo" onclick="document.getElementById('rival-logo-input').click()">üì∑ Subir escudo</button>
                </div>
            </div>

            <!-- Mi Equipo -->
            <div class="analisis-seccion">
                <h3>üè† Mi Equipo</h3>
                
                <div class="formacion-group">
                    <label>Sistema inicial:</label>
                    <select id="team-formation-initial" class="select-formacion">
                        <option value="">Seleccionar...</option>
                        <option value="1-4-3-3">1-4-3-3</option>
                        <option value="1-4-4-2">1-4-4-2</option>
                        <option value="1-4-2-3-1">1-4-2-3-1</option>
                        <option value="1-4-1-4-1">1-4-1-4-1</option>
                        <option value="1-3-5-2">1-3-5-2</option>
                        <option value="1-3-4-3">1-3-4-3</option>
                        <option value="1-5-3-2">1-5-3-2</option>
                        <option value="1-5-4-1">1-5-4-1</option>
                        <option value="1-4-5-1">1-4-5-1</option>
                        <option value="1-4-4-1-1">1-4-4-1-1</option>
                    </select>
                </div>
<!-- CAMPO VISUAL -->
                <div class="campo-futbol-container" id="campo-container" style="display:none;">
                    <div class="campo-titulo">
                        <span>‚öΩ Alineaci√≥n</span>
                        <span class="campo-sistema-badge" id="campo-sistema-label">--</span>
                    </div>
                    <div class="campo-futbol" id="campo-futbol">
                        <div class="campo-area-grande-arriba"></div>
                        <div class="campo-area-pequena-arriba"></div>
                        <div class="campo-area-grande-abajo"></div>
                        <div class="campo-area-pequena-abajo"></div>
                        <!-- Los jugadores se a√±aden din√°micamente -->
                    </div>
                    <div id="suplentes-campo" style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                        <p style="color: #9ca3af; font-size: 12px; margin-bottom: 8px;">üìã Suplentes:</p>
                        <div id="suplentes-lista" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                    </div>
                </div>
                <div class="formacion-cambios">
                    <p class="cambios-titulo">Cambios de sistema durante el partido:</p>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="team-change1-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="team-change1-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="team-change2-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="team-change2-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="team-change3-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="team-change3-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="team-change4-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="team-change4-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                </div>

                <div class="analisis-campos">
                    <div class="campo-analisis">
                        <label>üí™ Puntos fuertes</label>
                        <textarea id="team-strengths" rows="3" placeholder="¬øQu√© hicimos bien?"></textarea>
                    </div>
                    <div class="campo-analisis">
                        <label>üìà Aspectos a mejorar</label>
                        <textarea id="team-improvements" rows="3" placeholder="¬øQu√© podemos mejorar?"></textarea>
                    </div>
                    <div class="campo-analisis">
                        <label>üìã Notas t√°cticas</label>
                        <textarea id="team-tactical-notes" rows="3" placeholder="Observaciones t√°cticas..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Rival -->
            <div class="analisis-seccion">
                <h3>‚öîÔ∏è Rival</h3>
                
                <div class="formacion-group">
                    <label>Sistema inicial:</label>
                    <select id="opponent-formation-initial" class="select-formacion">
                        <option value="">Seleccionar...</option>
                        <option value="1-4-3-3">1-4-3-3</option>
                        <option value="1-4-4-2">1-4-4-2</option>
                        <option value="1-4-2-3-1">1-4-2-3-1</option>
                        <option value="1-4-1-4-1">1-4-1-4-1</option>
                        <option value="1-3-5-2">1-3-5-2</option>
                        <option value="1-3-4-3">1-3-4-3</option>
                        <option value="1-5-3-2">1-5-3-2</option>
                        <option value="1-5-4-1">1-5-4-1</option>
                        <option value="1-4-5-1">1-4-5-1</option>
                        <option value="1-4-4-1-1">1-4-4-1-1</option>
                    </select>
                </div>

                <div class="formacion-cambios">
                    <p class="cambios-titulo">Cambios de sistema durante el partido:</p>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="opponent-change1-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="opponent-change1-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="opponent-change2-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="opponent-change2-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="opponent-change3-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="opponent-change3-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                    <div class="cambio-row">
                        <span>Min</span>
                        <input type="number" id="opponent-change4-min" min="1" max="120" placeholder="--">
                        <span>‚Üí</span>
                        <select id="opponent-change4-system" class="select-formacion-small">
                            <option value="">--</option>
                            <option value="1-4-3-3">1-4-3-3</option>
                            <option value="1-4-4-2">1-4-4-2</option>
                            <option value="1-4-2-3-1">1-4-2-3-1</option>
                            <option value="1-4-1-4-1">1-4-1-4-1</option>
                            <option value="1-3-5-2">1-3-5-2</option>
                            <option value="1-3-4-3">1-3-4-3</option>
                            <option value="1-5-3-2">1-5-3-2</option>
                            <option value="1-5-4-1">1-5-4-1</option>
                        </select>
                    </div>
                </div>

                <div class="analisis-campos">
                    <div class="campo-analisis">
                        <label>üí™ Puntos fuertes del rival</label>
                        <textarea id="opponent-strengths" rows="3" placeholder="¬øQu√© hacen bien?"></textarea>
                    </div>
                    <div class="campo-analisis">
                        <label>üìâ Puntos d√©biles del rival</label>
                        <textarea id="opponent-weaknesses" rows="3" placeholder="¬øD√≥nde podemos hacerles da√±o?"></textarea>
                    </div>
                    <div class="campo-analisis">
                        <label>‚≠ê Jugadores clave</label>
                        <textarea id="opponent-key-players" rows="3" placeholder="Jugadores a vigilar..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Conclusiones generales -->
            <div class="analisis-seccion">
                <h3>üìù Conclusiones Generales</h3>
                <textarea id="general-conclusions" rows="5" placeholder="Resumen del partido, aprendizajes, ideas para futuros enfrentamientos..."></textarea>
            </div>

            <!-- Historial vs este rival -->
            <div class="analisis-seccion historial-rival" id="historial-rival" style="display:none;">
                <h3>üìö Historial vs <span id="historial-rival-nombre"></span></h3>
                <div id="historial-partidos"></div>
            </div>

            <!-- Botones -->
            <div class="analisis-botones">
                <button class="btn-guardar-analisis" onclick="guardarAnalisis()">üíæ Guardar An√°lisis</button>
                <button class="btn-pdf-analisis" onclick="generarPDFAnalisis()">üìÑ Generar PDF</button>
            </div>

        </div>
    </div>
</div>
</div>
<!-- ==================== MODULO: TU CUERPO T√âCNICO ==================== -->
<div id="modulo-staff" class="vista-modulo">
    <div class="staff-container">
        <div class="staff-header">
            <h2>üèÜ Tu Cuerpo T√©cnico</h2>
            <p>Tres expertos con IA para ayudarte en tu d√≠a a d√≠a como entrenador</p>
        </div>
        
        <div class="staff-grid">
            <!-- Johan - Planificador -->
            <div class="staff-card johan" onclick="abrirChatStaff('johan')">
                <div class="staff-avatar">
                    <img src="https://toplidercoach.com/wp-content/uploads/2025/12/captura-de-pantalla-2025-12-11-214833.png" alt="Johan">
                </div>
                <h3>Johan</h3>
                <p class="rol">Tu Planificador de Sesiones</p>
                <p class="descripcion">Experto en dise√±ar sesiones de entrenamiento personalizadas. Cu√©ntale tus objetivos, tiempo disponible y n√∫mero de jugadores, y te crear√° la sesi√≥n perfecta.</p>
                <button class="btn-consultar">Consultar a Johan</button>
            </div>
            
            <!-- Valeri - Analista -->
            <div class="staff-card valeri" onclick="abrirChatStaff('valeri')">
                <div class="staff-avatar">
                    <img src="https://toplidercoach.com/wp-content/uploads/2025/12/captura-de-pantalla-2025-12-11-214736.png" alt="Valeri">
                </div>
                <h3>Valeri</h3>
                <p class="rol">Tu Analista de Rendimiento</p>
                <p class="descripcion">Especialista en an√°lisis de datos y estad√≠sticas. Analiza el rendimiento de tus jugadores, compara m√©tricas y detecta patrones para mejorar.</p>
                <button class="btn-consultar">Consultar a Valeri</button>
            </div>
            
            <!-- Arrigo - T√°ctico -->
            <div class="staff-card arrigo" onclick="abrirChatStaff('arrigo')">
                <div class="staff-avatar">
                    <img src="https://toplidercoach.com/wp-content/uploads/2025/12/captura-de-pantalla-2025-12-11-214756.png" alt="Arrigo">
                </div>
                <h3>Arrigo</h3>
                <p class="rol">Tu Entrenador T√°ctico</p>
                <p class="descripcion">Maestro de la t√°ctica y la estrategia. Preg√∫ntale sobre sistemas de juego, ejercicios espec√≠ficos para mejorar aspectos t√°cticos de tu equipo.</p>
                <button class="btn-consultar">Consultar a Arrigo</button>
            </div>
        </div>
    </div>
</div>
        <!-- ==================== MODULO: MI CLUB ==================== -->
        <div id="modulo-config" class="vista-modulo">
            <div class="sub-tabs config-subtabs">
                <button class="sub-tab active" onclick="cambiarSubTab('config', 'datos', this)">Datos del Club</button>
                <button class="sub-tab" onclick="cambiarSubTab('config', 'temporadas', this)">Temporadas</button>
                <button class="sub-tab" onclick="cambiarSubTab('config', 'plantilla', this)">Plantilla</button>
            </div>
            
            <!-- Sub: Datos del Club -->
            <div id="config-datos" class="vista-contenido active">
                <div class="card" style="max-width: 800px;">
                    <div class="card-header">
                        <h3>Datos del Club</h3>
                    </div>
                    <div class="card-body">
                        <div class="config-club-content">
                            <div class="escudo-section">
                                <div class="escudo-upload" onclick="document.getElementById('escudo-input').click()">
                                    <img id="escudo-preview" src="" alt="" style="display: none;">
                                    <div id="escudo-placeholder">
                                        <div class="icon">+</div>
                                        <span>Subir escudo</span>
                                    </div>
                                </div>
                                <input type="file" id="escudo-input" accept="image/*" style="display: none;" onchange="previsualizarEscudo(event)">
                                <p class="escudo-hint">JPG, PNG (max 2MB)</p>
                            </div>
                            
                            <div class="club-form">
                                <div class="form-group">
                                    <label>Nombre del Club *</label>
                                    <input type="text" id="club-nombre" placeholder="Ej: CD Villareal">
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Pais</label>
                                        <select id="club-pais">
                                            <option value="Espana">Espana</option>
                                            <option value="Mexico">Mexico</option>
                                            <option value="Argentina">Argentina</option>
                                            <option value="Colombia">Colombia</option>
                                            <option value="Chile">Chile</option>
                                            <option value="Peru">Peru</option>
                                            <option value="Otro">Otro</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Formato de Equipo</label>
                                        <select id="club-formato">
                                            <option value="11">Futbol 11</option>
                                            <option value="8">Futbol 8</option>
                                            <option value="7">Futbol 7</option>
                                            <option value="5">Futbol Sala</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <button class="btn-primary" onclick="guardarClub()">Guardar Cambios</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sub: Temporadas -->
            <div id="config-temporadas" class="vista-contenido">
                <div class="card" style="max-width: 800px;">
                    <div class="card-header">
                        <h3>Temporadas</h3>
                    </div>
                    <div class="card-body">
                        <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 15px; border-radius: 0 10px 10px 0; margin-bottom: 20px;">
                            <strong>Como funcionan las temporadas</strong>
                            <p style="margin: 5px 0 0; font-size: 14px; color: #065f46;">Cada temporada tiene su propia plantilla (max 30 jugadores). Las sesiones, partidos y estadisticas se asocian a la temporada activa.</p>
                        </div>
                        
                        <div id="lista-temporadas" class="temporadas-grid">
                            <div class="loading">Cargando temporadas...</div>
                        </div>
                        
                        <div class="nueva-temporada-form">
                            <h4>+ Crear Nueva Temporada</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input type="text" id="nueva-temp-nombre" placeholder="2026/2027">
                                </div>
                                <div class="form-group">
                                    <label>Fecha Inicio</label>
                                    <input type="date" id="nueva-temp-inicio">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fecha Fin</label>
                                    <input type="date" id="nueva-temp-fin">
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button class="btn-primary green" style="width: 100%;" onclick="crearTemporada()">Crear Temporada</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sub: Plantilla -->
            <div id="config-plantilla" class="vista-contenido">
                <div class="section-header">
                    <div class="plantilla-header" style="width: 100%;">
                        <div class="filtro-grupo">
                            <label>Temporada:</label>
                            <select id="plantilla-temporada" onchange="cargarPlantilla()"></select>
                        </div>
                        <div id="plantilla-contador" class="plantilla-contador">0 / 30 jugadores</div>
                    </div>
                </div>
                
                <div id="lista-jugadores" class="jugadores-grid">
                    <div class="loading">Cargando jugadores...</div>
                </div>
            </div>
        </div>
    </div>
    
   <!-- ==================== MODAL: NUEVO PARTIDO ==================== -->
    <div id="modal-partido" class="modal-overlay" style="display: none;" onclick="cerrarModalPartido(event)">
        <div class="modal-content modal-large" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-partido-titulo">Nuevo Partido</h3>
                <button class="modal-close" onclick="cerrarModalPartido()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="partido-id" value="">
                
                <!-- DATOS DEL PARTIDO -->
                <div class="seccion-modal">
                    <h4 class="seccion-titulo">Datos del Partido</h4>
                  <div class="form-row">
                        <div class="form-group">
                            <label>Rival *</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div id="partido-rival-escudo" style="width: 40px; height: 40px; border-radius: 8px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px dashed #d1d5db; overflow: hidden;" onclick="document.getElementById('partido-rival-escudo-input').click()">
                                    <span style="font-size: 20px;">üõ°Ô∏è</span>
                                </div>
                                <input type="file" id="partido-rival-escudo-input" accept="image/*" style="display: none;" onchange="previsualizarEscudoRival(event)">
                                <input type="text" id="partido-rival" placeholder="Nombre del equipo rival" style="flex: 1;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Competicion</label>
                            <select id="partido-competicion">
                                <option value="">Selecciona competici√≥n</option>
                                <option value="Liga">Liga</option>
                                <option value="Copa">Copa</option>
                                <option value="Amistoso">Amistoso</option>
                                <option value="Entrenamiento">Entrenamiento</option>
                                <option value="Otra competici√≥n">Otra competici√≥n</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha *</label>
                            <input type="date" id="partido-fecha">
                        </div>
                        <div class="form-group">
                            <label>Hora partido</label>
                            <input type="time" id="partido-hora">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Local/Visitante</label>
                            <select id="partido-localidad">
                                <option value="home">Local</option>
                                <option value="away">Visitante</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estadio/Campo</label>
                            <input type="text" id="partido-estadio" placeholder="Nombre del campo">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jornada/Ronda</label>
                            <input type="text" id="partido-jornada" placeholder="Jornada 1, Cuartos...">
                        </div>
                        <div class="form-group">
                            <label>Formato de juego</label>
                            <select id="partido-formato">
                                <option value="11">F√∫tbol 11</option>
                                <option value="8">F√∫tbol 8</option>
                                <option value="7">F√∫tbol 7</option>
                                <option value="5">F√∫tbol 5</option>
                            </select>
                        </div>
                    </div>
                </div>
                
              
<!-- DATOS DE CONVOCATORIA -->
<div class="seccion-modal">
    <h4 class="seccion-titulo">Datos de Convocatoria</h4>
    <div class="form-row">
        <div class="form-group">
            <label>Lugar de encuentro</label>
            <input type="text" id="partido-lugar-encuentro" placeholder="Vestuarios, parking...">
        </div>
        <div class="form-group">
            <label>Fecha de salida</label>
            <input type="date" id="partido-fecha-salida">
        </div>
    </div>
    <div class="form-row">
        <div class="form-group">
            <label>Hora de salida</label>
            <input type="time" id="partido-hora-salida">
        </div>
        <div class="form-group"></div>
    </div>
    <div class="form-group">
        <label>Notas para jugadores</label>
        <textarea id="partido-notas-convocatoria" rows="2" placeholder="Llevar equipaci√≥n azul, documentaci√≥n..."></textarea>
    </div>
</div>
       <!-- VIDEO DEL PARTIDO - A√±adir ANTES de la secci√≥n CONVOCADOS -->
<div class="seccion-modal">
    <h4 class="seccion-titulo">üé• Video del Partido</h4>
    <div class="video-input-container" id="video-input-container">
        <div class="form-group">
            <label>Enlace del video</label>
            <input type="url" id="partido-video-url" placeholder="Pega aqu√≠ el enlace de YouTube, Vimeo o Google Drive..." oninput="actualizarPreviewVideo()">
        </div>
        <div class="video-plataformas-hint">
            <span class="plataforma-badge youtube">‚ñ∂Ô∏è YouTube</span>
            <span class="plataforma-badge drive">üìÅ Google Drive</span>
            <span class="plataforma-badge vimeo">üé¨ Vimeo</span>
        </div>
        <p class="hint-text">Sube tu video a cualquiera de estas plataformas y pega el enlace aqu√≠</p>
        
        <!-- Preview del video (se muestra cuando hay enlace) -->
        <div id="video-preview-container" style="display: none; margin-top: 15px;">
            <div id="video-preview"></div>
            <div class="video-actions" style="margin-top: 10px; display: flex; gap: 10px;">
                <a id="video-link-externo" href="#" target="_blank" class="btn-secondary" style="flex: 1; text-align: center; text-decoration: none;">
                    üîó Abrir en nueva pesta√±a
                </a>
                <button type="button" class="btn-danger" onclick="eliminarVideoPartido()" style="padding: 10px 20px;">
                    üóëÔ∏è Quitar
                </button>
            </div>
        </div>
    </div>
</div>         
                <!-- CONVOCADOS -->
                <div class="seccion-modal">
                    <div class="seccion-titulo-con-contador">
                        <h4 class="seccion-titulo">Jugadores Convocados</h4>
                        <span id="contador-convocados" class="contador-jugadores">0 convocados</span>
                    </div>
                    <div id="convocatoria-grid" class="convocatoria-grid">
                        <div class="loading">Cargando jugadores...</div>
                    </div>
                </div>
                
                <!-- ALINEACI√ìN -->
                <div class="seccion-modal">
                    <div class="seccion-titulo-con-contador">
                        <h4 class="seccion-titulo">Alineaci√≥n</h4>
                        <span id="contador-titulares" class="contador-jugadores">0/11 titulares</span>
                    </div>
                    <div class="alineacion-controls">
                        <div class="form-group" style="margin-bottom:0;">
                            <label style="font-size:12px;">Formaci√≥n:</label>
                            <select id="partido-formacion" onchange="slotsTitularesMap=[];slotVacioIdx=null;renderizarAlineacion()" class="select-formacion-partido">
                                <option value="4-3-3">4-3-3</option>
                                <option value="4-4-2">4-4-2</option>
                                <option value="4-2-3-1">4-2-3-1</option>
                                <option value="4-1-4-1">4-1-4-1</option>
                                <option value="3-5-2">3-5-2</option>
                                <option value="3-4-3">3-4-3</option>
                                <option value="5-3-2">5-3-2</option>
                                <option value="5-4-1">5-4-1</option>
                            </select>
                        </div>
                        <p class="hint-text" style="margin:0;">Haz clic en los convocados para a√±adirlos como titulares.</p>
                    </div>
                    <div class="alineacion-layout">
                        <div class="campo-futbol-container">
                            <div class="campo-titulo">
                                <span>‚öΩ Alineaci√≥n</span>
                                <span class="campo-sistema-badge" id="pitch-formation-label">4-3-3</span>
                            </div>
                            <div class="campo-futbol" id="pitch-visual">
                                <div class="campo-area-grande-arriba"></div>
                                <div class="campo-area-pequena-arriba"></div>
                                <div class="campo-area-grande-abajo"></div>
                                <div class="campo-area-pequena-abajo"></div>
                                <!-- Jugadores se insertan din√°micamente -->
                            </div>
                            <div class="suplentes-campo" id="suplentes-campo-container">
                                <span class="suplentes-campo-titulo">ü™ë Suplentes:</span>
                                <div id="suplentes-grid" class="suplentes-campo-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer modal-footer-partido">
                <div class="footer-izq">
                    <button class="btn-secondary" onclick="generarPDFConvocatoria()">üìã PDF Convocatoria</button>
                    <button class="btn-secondary" onclick="generarPDFAlineacion()">üìù PDF Alineaci√≥n</button>
                    <button class="btn-secondary" onclick="generarPDFHojaPartido()">üìÑ Hoja de Partido</button>
                </div>
                <div class="footer-der">
                    <button class="btn-secondary" onclick="cerrarModalPartido()">Cancelar</button>
                    <button class="btn-primary green" onclick="guardarPartido()">Guardar Partido</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ==================== MODAL: RESULTADO Y STATS ==================== -->
    <div id="modal-resultado" class="modal-overlay" style="display: none;" onclick="cerrarModalResultado(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Resultado y Estadisticas</h3>
                <button class="modal-close" onclick="cerrarModalResultado()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="resultado-partido-id" value="">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Goles a favor</label>
                        <input type="number" id="resultado-favor" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Goles en contra</label>
                        <input type="number" id="resultado-contra" min="0" value="0">
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px;">Estadisticas por Jugador</h4>
                    <div class="stats-labels">
                        <span>Jugador</span>
                        <span>Min</span>
                        <span>Goles</span>
                        <span>Asist.</span>
                        <span>TA</span>
                        <span>TR</span>
                    </div>
                    <div id="stats-jugadores-grid" class="stats-jugadores-grid">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModalResultado()">Cancelar</button>
                <button class="btn-primary green" onclick="guardarResultado()">Guardar Resultado</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== MODAL: JUGADOR ==================== -->
    <div id="modal-jugador" class="modal-overlay" style="display: none;" onclick="cerrarModalJugador(event)">
        <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-jugador-titulo">Nuevo Jugador</h3>
                <button class="modal-close" onclick="cerrarModalJugador()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="jugador-id" value="">
                <input type="hidden" id="jugador-sp-id" value="">
                
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="escudo-upload" style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%;" onclick="document.getElementById('jugador-foto-input').click()">
                        <img id="jugador-foto-preview" src="" alt="" style="display: none; border-radius: 50%;">
                        <div id="jugador-foto-placeholder">
                            <div class="icon" style="font-size: 24px;">+</div>
                        </div>
                    </div>
                    <input type="file" id="jugador-foto-input" accept="image/*" style="display: none;" onchange="previsualizarFotoJugador(event)">
                </div>
                
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" id="jugador-nombre" placeholder="Nombre y apellidos">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Dorsal *</label>
                        <input type="number" id="jugador-dorsal" min="1" max="99">
                    </div>
                    <div class="form-group">
                        <label>Posicion *</label>
                        <select id="jugador-posicion">
                            <option value="">Seleccionar...</option>
                            <option value="Portero">Portero</option>
                            <option value="Defensa Central">Defensa Central</option>
                            <option value="Lateral Derecho">Lateral Derecho</option>
                            <option value="Lateral Izquierdo">Lateral Izquierdo</option>
                            <option value="Mediocentro Defensivo">Mediocentro Defensivo</option>
                            <option value="Mediocentro">Mediocentro</option>
                            <option value="Mediapunta">Mediapunta</option>
                            <option value="Extremo Derecho">Extremo Derecho</option>
                            <option value="Extremo Izquierdo">Extremo Izquierdo</option>
                            <option value="Delantero Centro">Delantero Centro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha Nacimiento</label>
                        <input type="date" id="jugador-nacimiento">
                    </div>
                    <div class="form-group">
                        <label>Pie Dominante</label>
                        <select id="jugador-pie">
                            <option value="Derecho">Derecho</option>
                            <option value="Izquierdo">Izquierdo</option>
                            <option value="Ambidiestro">Ambidiestro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Altura (cm)</label>
                        <input type="number" id="jugador-altura" placeholder="175">
                    </div>
                    <div class="form-group">
                        <label>Peso (kg)</label>
                        <input type="number" id="jugador-peso" placeholder="70" step="0.1">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Telefono</label>
                        <input type="tel" id="jugador-telefono" placeholder="+34 600...">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="jugador-email" placeholder="jugador@email.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Estado</label>
                    <select id="jugador-estado">
                        <option value="available">Disponible</option>
                        <option value="injured">Lesionado</option>
                        <option value="suspended">Sancionado</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModalJugador()">Cancelar</button>
                <button class="btn-primary" onclick="guardarJugador()">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== MODAL: SELECCI√ìN SECCI√ìN ==================== -->
    <div id="modal-seccion" class="modal-overlay" style="display: none;" onclick="cerrarModalSeccion(event)">
        <div class="modal-content" style="max-width: 400px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Selecciona la Seccion</h3>
                <button class="modal-close" onclick="cerrarModalSeccion()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
            <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 10px;">
                <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px;">‚è±Ô∏è Duraci√≥n (minutos)</label>
                <input type="number" id="ejercicio-duracion-input" value="15" min="1" max="120" style="width: 100px; padding: 10px; border: 2px solid #7c3aed; border-radius: 8px; font-size: 18px; font-weight: 600; text-align: center;">
            </div>
            <p style="margin-bottom: 15px; color: #6b7280; font-size: 14px;">¬øA qu√© parte de la sesi√≥n?</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn-primary" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);" onclick="seleccionarSeccion('calentamiento')">Calentamiento</button>
                    <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" onclick="seleccionarSeccion('principal')">Parte Principal</button>
                    <button class="btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" onclick="seleccionarSeccion('enfriamiento')">Enfriamiento</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ==================== MODAL: OPCIONES PDF SESI√ìN ==================== -->
<div id="modal-pdf-sesion" class="modal-overlay" style="display: none;" onclick="cerrarModalPDFSesion(event)">
    <div class="modal-content" style="max-width: 400px;" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3>Descargar PDF de Sesi√≥n</h3>
            <button class="modal-close" onclick="cerrarModalPDFSesion()">&times;</button>
        </div>
        <div class="modal-body" style="text-align: center;">
            <p style="margin-bottom: 20px; color: #6b7280;">¬øC√≥mo quieres el PDF?</p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="btn-primary purple" onclick="descargarPDFSesion(true)">üìÑ PDF con t√≠tulos de ejercicios</button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #059669 0%, #047857 100%);" onclick="descargarPDFSesion(false)">üìÑ PDF sin t√≠tulos (limpio)</button>
            </div>
        </div>
    </div>
</div>
<!-- ==================== MODAL: FICHA JUGADOR STATS ==================== -->
<div id="modal-ficha-jugador" class="modal-overlay" style="display: none;" onclick="cerrarModalFichaJugador(event)">
    <div class="modal-content" style="max-width: 800px;" onclick="event.stopPropagation()">
        <div class="modal-header" style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%); color: white;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div id="ficha-foto" style="width: 60px; height: 60px; border-radius: 50%; background: #6b7280; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; overflow: hidden;">
                    ?
                </div>
                <div>
                    <h3 id="ficha-nombre" style="margin: 0;">Nombre del Jugador</h3>
                    <p id="ficha-posicion" style="margin: 5px 0 0; opacity: 0.8; font-size: 14px;">Posici√≥n</p>
                </div>
            </div>
            <button class="modal-close" onclick="cerrarModalFichaJugador()" style="color: white;">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Datos personales -->
            <div id="ficha-datos-personales" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; padding: 15px; background: #f8fafc; border-radius: 12px;">
                <!-- Se genera din√°micamente -->
            </div>
            
            <!-- Resumen estad√≠sticas -->
            <h4 style="font-size: 14px; color: #374151; margin-bottom: 15px;">üìä Resumen de Temporada</h4>
            <div id="ficha-stats-resumen" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 25px;">
                <!-- Se genera din√°micamente -->
            </div>
            
            <!-- Detalle partido a partido -->
            <h4 style="font-size: 14px; color: #374151; margin-bottom: 15px;">‚öΩ Participaci√≥n por Partido</h4>
            <div style="overflow-x: auto;">
                <table class="stats-tabla" id="ficha-partidos-tabla">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Rival</th>
                            <th>Resultado</th>
                            <th>Min</th>
                            <th>Goles</th>
                            <th>Asist</th>
                            <th>TA</th>
                            <th>TR</th>
                        </tr>
                    </thead>
                    <tbody id="ficha-partidos-body">
                        <!-- Se genera din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="cerrarModalFichaJugador()">Cerrar</button>
            <button class="btn-primary" onclick="exportarFichaJugadorPDF()">üìÑ Exportar PDF</button>
        </div>
    </div>
</div>
<!-- ==================== MODAL: CHAT STAFF ==================== -->
<div id="modal-chat-staff" class="modal-overlay" style="display: none;" onclick="cerrarChatStaff(event)">
    <div class="modal-content" style="max-width: 600px;" onclick="event.stopPropagation()">
        <div class="modal-header" id="chat-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div class="staff-avatar" id="chat-avatar" style="width: 45px; height: 45px; font-size: 20px; margin: 0;"></div>
                <div>
                    <h3 id="chat-nombre" style="margin: 0;">Asistente</h3>
                    <p id="chat-rol" style="margin: 0; font-size: 12px; opacity: 0.8;"></p>
                </div>
            </div>
            <button class="modal-close" onclick="cerrarChatStaff()">&times;</button>
        </div>
        <div class="modal-body" style="padding: 0;">
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <!-- Mensajes se generan din√°micamente -->
                </div>
                <div style="padding: 15px;">
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Escribe tu consulta..." onkeypress="if(event.key==='Enter')enviarMensajeChat()">
                        <button onclick="enviarMensajeChat()">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Bot√≥n flotante de Asistencia -->
<button id="btn-asistencia" onclick="togglePanelAsistencia()" title="Asistencia y Bienestar">
    <span>üìã</span>
</button>

<!-- Modal Asistencia Sesi√≥n -->
<div id="modal-asistencia-sesion" class="modal-overlay" style="display:none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>üìã Registro de Asistencia y Bienestar</h3>
<button type="button" onclick="mostrarGuiaEscalas()" style="background:#f59e0b;color:white;border:none;padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;margin-right:10px;">‚ùì Gu√≠a de Escalas</button>
            <button class="modal-close" onclick="cerrarModalAsistenciaSesion()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="asistencia-sesion-info" style="background:#f0fdf4;padding:12px;border-radius:8px;margin-bottom:15px;">
                <strong id="asistencia-sesion-nombre">Sesi√≥n</strong> - <span id="asistencia-sesion-fecha"></span>
            </div>
            <div id="modal-asistencia-jugadores" class="modal-asistencia-grid">
                <p style="text-align:center;color:#9ca3af;">Cargando jugadores...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="cerrarModalAsistenciaSesion()">Cancelar</button>
            <button class="btn-primary green" onclick="guardarAsistenciaSesion()">üíæ Guardar Asistencia</button>
        </div>
    </div>
</div>

    <!-- JS Modular (ORDEN IMPORTA: security y core siempre primero) -->
    <script src="js/security.js"></script>
    <script src="js/core.js"></script>
    <script src="js/video-utils.js"></script>
    <script src="js/pdf-generators.js"></script>
    <script src="js/planificador.js"></script>
    <script src="js/matchstats.js"></script>
    <script src="js/analisis.js"></script>
    <script src="js/staff.js"></script>
    <script src="js/miclub.js"></script>
    <script src="js/asistencia.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>