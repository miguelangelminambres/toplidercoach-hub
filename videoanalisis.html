<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VideoAnÃ¡lisis - TopLiderCoach</title>
  <link rel="stylesheet" href="css/videoanalisis.css">
</head>
<body>
<div class="va-app">

  <!-- â•â•â• UPLOAD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="va-upload-screen" class="va-upload-screen">
    <div id="va-upload-box" class="va-upload-box">
      <div class="va-upload-icon">ğŸ¬</div>
      <div class="va-upload-title">Cargar vÃ­deo del partido</div>
      <div class="va-upload-sub">Arrastra o haz clic para seleccionar<br>MP4, MOV, WebM, AVI</div>
      <div class="va-upload-btn">ğŸ“ Seleccionar archivo</div>
      <input type="file" id="va-file-input" accept="video/*" style="display:none">
    </div>
  </div>

  <!-- â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="va-main" class="va-main">

    <!-- Header -->
    <div class="va-header">
      <div class="va-logo">
        <div class="va-logo-icon">ğŸ¬</div>
        <div>
          <h1>VideoAnÃ¡lisis</h1>
          <p id="va-video-name">-</p>
        </div>
      </div>
      <div class="va-header-actions">
        <button class="va-btn" onclick="vaSnapshot()">ğŸ“¸ Captura</button>
        <button class="va-btn" onclick="vaExportAnalysis()">ğŸ’¾ Exportar</button>
        <button class="va-btn va-btn-danger" onclick="vaNewVideo()">âœ• Nuevo</button>
      </div>
    </div>

    <div class="va-content">

      <!-- â•â•â• LEFT: Video + Timeline + Table â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="va-left">

        <!-- Video -->
        <div class="va-video-container">
          <video id="va-video"></video>
          <canvas id="va-canvas"></canvas>
          <div class="va-draw-badge" id="va-draw-badge">
            âœï¸ <span id="va-draw-mode-label">-</span>
            <span class="close" onclick="vaSetDrawMode(null)">âœ•</span>
          </div>
          <div class="va-text-overlay" id="va-text-overlay">
            <input type="text" id="va-text-input" class="va-input" placeholder="Texto..." style="width:160px"
              onkeydown="if(event.key==='Enter')vaAddTextDrawing()">
            <button class="va-btn va-btn-teal va-btn-sm" onclick="vaAddTextDrawing()">OK</button>
            <button class="va-btn va-btn-sm" onclick="vaCancelText()">âœ•</button>
          </div>
        </div>

        <!-- Controls -->
        <div class="va-controls">
          <button class="va-ctrl" onclick="vaStepFrame(-1)" title="Frame anterior (,)">âª</button>
          <button class="va-ctrl va-ctrl-play" id="va-play-btn" onclick="vaTogglePlay()">â–¶</button>
          <button class="va-ctrl" onclick="vaStepFrame(1)" title="Frame siguiente (.)">â©</button>
          <button class="va-ctrl va-ctrl-speed" id="va-speed-btn" onclick="vaChangeSpeed()">1x</button>
          <div class="va-time">
            <span id="va-current-time">00:00</span>
            <span class="sep">/</span>
            <span id="va-total-time">00:00</span>
          </div>
          <div class="va-volume">ğŸ”Š <input type="range" min="0" max="1" step="0.05" value="0.7" oninput="vaChangeVolume(this.value)"></div>
        </div>

        <!-- Period bar -->
        <div class="va-period-bar">
          <button class="va-period-btn active" data-period="all" onclick="vaSetPeriod('all')">Todo</button>
          <button class="va-period-btn" data-period="1" onclick="vaSetPeriod('1')">1Âª Parte</button>
          <button class="va-period-btn" data-period="2" onclick="vaSetPeriod('2')">2Âª Parte</button>
          <div class="va-period-sep"></div>
          <button class="va-period-range" data-range="0-15" onclick="vaSetRange('0-15')">0-15</button>
          <button class="va-period-range" data-range="15-30" onclick="vaSetRange('15-30')">16-30</button>
          <button class="va-period-range" data-range="30-45" onclick="vaSetRange('30-45')">31-45+</button>
          <button class="va-period-range" data-range="45-60" onclick="vaSetRange('45-60')">46-60</button>
          <button class="va-period-range" data-range="60-75" onclick="vaSetRange('60-75')">61-75</button>
          <button class="va-period-range" data-range="75-99" onclick="vaSetRange('75-99')">76-90+</button>
        </div>

        <!-- Timeline -->
        <div class="va-timeline-area">
          <div class="va-timeline" id="va-timeline" onclick="vaTimelineClick(event)">
            <div class="va-timeline-progress" id="va-tl-progress"></div>
            <div id="va-tl-markers"></div>
            <div id="va-tl-clips"></div>
            <div class="va-timeline-playhead" id="va-tl-playhead"></div>
          </div>
        </div>

        <!-- Play-by-Play Table -->
        <div class="va-table-area">
          <table class="va-table">
            <thead>
              <tr>
                <th style="width:24px;text-align:center">#</th>
                <th style="width:22px"></th>
                <th>CategorÃ­a</th>
                <th style="width:48px">Tiempo</th>
                <th style="width:28px;text-align:center">Per</th>
                <th style="width:40px">Jug</th>
                <th style="width:70px">Zona</th>
                <th>Nota</th>
              </tr>
            </thead>
            <tbody id="va-table-body">
              <tr><td colspan="8" class="va-table-empty">Etiqueta acciones usando los botones del panel derecho â†’</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- â•â•â• RIGHT PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="va-panel">

        <div class="va-tabs">
          <button class="va-tab active" data-panel="events" onclick="vaSwitchPanel('events')">
            ğŸ·ï¸ Etiquetar <span class="badge" id="va-event-count" style="display:none">0</span>
          </button>
          <button class="va-tab" data-panel="draw" onclick="vaSwitchPanel('draw')">âœï¸ Dibujar</button>
          <button class="va-tab" data-panel="tracking" onclick="vaSwitchPanel('tracking')">ğŸ“ Tracking</button>
          <button class="va-tab" data-panel="clips" onclick="vaSwitchPanel('clips')">âœ‚ï¸ Clips</button>
        </div>

        <div class="va-panel-body">

          <!-- â•â•â• ETIQUETAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
          <div class="va-section active" id="va-sec-events">

            <!-- Team selector -->
            <p class="va-label">Equipo</p>
            <div class="va-team-toggle">
              <button class="va-team-btn active" data-team="local" onclick="vaSelectTeam('local')">ğŸ  Local</button>
              <button class="va-team-btn" data-team="visitor" onclick="vaSelectTeam('visitor')">âœˆï¸ Visitante</button>
            </div>

            <!-- Actions -->
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:2px">
              <p class="va-label" style="margin:0">AcciÃ³n</p>
              <button class="va-btn-icon" onclick="vaToggleCatEditor()" title="Editar acciones">âš™ï¸</button>
            </div>
            <div class="va-action-grid" id="va-action-grid"></div>

            <!-- Category editor (hidden by default) -->
            <div id="va-cat-editor" style="display:none;margin-bottom:8px">
              <div id="va-cat-editor-list"></div>
              <div style="display:flex;gap:4px;margin-top:4px">
                <button class="va-btn va-btn-teal va-btn-sm" onclick="vaAddCategory()" style="flex:1">+ Nueva acciÃ³n</button>
                <button class="va-btn va-btn-sm" onclick="vaResetCategories()">â†© Reset</button>
              </div>
            </div>

            <!-- Descriptors (dynamic) -->
            <div id="va-descriptors" style="display:none"></div>

            <!-- Player -->
            <p class="va-label">Jugador</p>
            <input type="text" class="va-input" id="va-event-player" placeholder="NÂº dorsal o nombre..." style="margin-bottom:6px">

            <!-- Mini field visual -->
            <p class="va-label">Zona del campo</p>
            <div class="va-minifield-wrap">
              <svg class="va-minifield" viewBox="0 0 240 150" xmlns="http://www.w3.org/2000/svg">
                <!-- Field background -->
                <rect x="0" y="0" width="240" height="150" rx="4" fill="#1a472a" stroke="#2d6b3f" stroke-width="1.5"/>
                <!-- Center line and circle -->
                <line x1="120" y1="0" x2="120" y2="150" stroke="#2d6b3f" stroke-width="1"/>
                <circle cx="120" cy="75" r="20" fill="none" stroke="#2d6b3f" stroke-width="1"/>
                <!-- Left penalty area -->
                <rect x="0" y="30" width="36" height="90" fill="none" stroke="#2d6b3f" stroke-width="1"/>
                <rect x="0" y="50" width="14" height="50" fill="none" stroke="#2d6b3f" stroke-width="1"/>
                <!-- Right penalty area -->
                <rect x="204" y="30" width="36" height="90" fill="none" stroke="#2d6b3f" stroke-width="1"/>
                <rect x="226" y="50" width="14" height="50" fill="none" stroke="#2d6b3f" stroke-width="1"/>
                <!-- Click zones (3x3) -->
                <rect class="va-fz" data-zone="off-izq"  x="0"   y="0"   width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="off-cen"  x="80"  y="0"   width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="off-der"  x="160" y="0"   width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="med-izq"  x="0"   y="50"  width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="med-cen"  x="80"  y="50"  width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="med-der"  x="160" y="50"  width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="def-izq"  x="0"   y="100" width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="def-cen"  x="80"  y="100" width="80" height="50" fill="transparent" stroke="none"/>
                <rect class="va-fz" data-zone="def-der"  x="160" y="100" width="80" height="50" fill="transparent" stroke="none"/>
                <!-- Zone labels -->
                <text x="40"  y="28"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">OFENS</text>
                <text x="120" y="28"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">OFENS</text>
                <text x="200" y="28"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">OFENS</text>
                <text x="40"  y="78"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">MEDIO</text>
                <text x="120" y="78"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">MEDIO</text>
                <text x="200" y="78"  text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">MEDIO</text>
                <text x="40"  y="128" text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">DEFENS</text>
                <text x="120" y="128" text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">DEFENS</text>
                <text x="200" y="128" text-anchor="middle" fill="#4ade80" font-size="8" opacity="0.5">DEFENS</text>
                <!-- Side labels -->
                <text x="2" y="78" fill="#4ade80" font-size="7" opacity="0.4" transform="rotate(-90,6,78)">IZQ</text>
                <text x="234" y="78" fill="#4ade80" font-size="7" opacity="0.4" transform="rotate(90,234,78)">DER</text>
              </svg>
              <div class="va-minifield-arrows">
                <span>â† PorterÃ­a rival</span>
                <span>PorterÃ­a propia â†’</span>
              </div>
            </div>

            <!-- Note -->
            <p class="va-label">Nota</p>
            <div class="va-add-row">
              <input type="text" class="va-input" id="va-event-note" placeholder="Nota opcional..."
                onkeydown="if(event.key==='Enter')vaAddEvent()">
              <button class="va-btn va-btn-teal" onclick="vaAddEvent()">+ AÃ±adir</button>
            </div>

            <p style="font-size:9px;color:var(--va-dim);margin-top:4px">
              ğŸ’¡ Equipo â†’ AcciÃ³n â†’ Descriptor â†’ Jugador â†’ Zona â†’ Nota â†’ AÃ±adir. Atajos: 1-9, 0, Q, W + Enter
            </p>
          </div>

          <!-- â•â•â• DIBUJAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
          <div class="va-section" id="va-sec-draw">
            <p class="va-label">Herramientas</p>
            <div class="va-draw-tools" id="va-draw-tools"></div>

            <p class="va-label">Color</p>
            <div class="va-colors" id="va-color-picker"></div>

            <p class="va-label">Grosor</p>
            <div class="va-line-widths" id="va-line-widths"></div>

            <div class="va-draw-actions">
              <button class="va-btn" id="va-undo-btn" onclick="vaUndo()" style="flex:1;opacity:0.4" disabled>â†©ï¸ Deshacer</button>
              <button class="va-btn" id="va-redo-btn" onclick="vaRedo()" style="flex:1;opacity:0.4" disabled>â†ªï¸ Rehacer</button>
              <button class="va-btn" onclick="vaClearDrawings()" style="flex:1">ğŸ—‘ï¸ Borrar</button>
            </div>

            <button class="va-btn" id="va-toggle-draw" onclick="vaToggleDrawVisibility()" style="width:100%;margin-bottom:6px">
              ğŸ‘ï¸ Ocultar
            </button>
            <button class="va-btn va-btn-teal" onclick="vaSnapshot()" style="width:100%">
              ğŸ“¸ Captura con dibujos
            </button>
            <p class="va-draw-hint">ğŸ’¡ Dibujos visibles 5s. Ãrea: clic mÃºltiple, doble-clic cierra. Ctrl+Z deshacer. ESC salir.</p>
          </div>

          <!-- â•â•â• TRACKING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
          <div class="va-section" id="va-sec-tracking">
            <p class="va-label">Jugadores</p>
            <div style="display:flex;gap:4px;margin-bottom:8px">
              <button class="va-btn va-btn-teal" onclick="vaAddTrack()" style="flex:1">+ Nuevo jugador</button>
            </div>

            <button class="va-btn" id="va-track-mode-btn" onclick="vaToggleTrackMode()" style="width:100%;margin-bottom:8px">
              ğŸ“ Activar posicionamiento
            </button>

            <div id="va-track-list">
              <div class="va-empty">AÃ±ade jugadores para hacer seguimiento.</div>
            </div>

            <p class="va-label" style="margin-top:10px">Conexiones (<span id="va-track-count">0</span>)</p>
            <button class="va-btn" onclick="vaAddConnection()" style="width:100%;margin-bottom:6px">ğŸ”— Conectar jugadores</button>
            <div id="va-connection-list">
              <div class="va-empty" style="font-size:10px">Sin conexiones.</div>
            </div>

            <button class="va-btn" id="va-toggle-tracks" onclick="vaToggleTrackVisibility()" style="width:100%;margin-top:8px">
              ğŸ‘ï¸ Ocultar tracking
            </button>

            <p class="va-draw-hint">
              ğŸ’¡ <strong>Flujo:</strong> AÃ±ade jugador â†’ Activa posicionamiento â†’ Pausa vÃ­deo â†’ Clic en jugador â†’ Avanza â†’ Repite.<br>
              El sistema interpola automÃ¡ticamente entre puntos.
            </p>
          </div>

          <!-- â•â•â• CLIPS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
          <div class="va-section" id="va-sec-clips">
            <p class="va-label">Marcar clip</p>
            <div class="va-clip-markers">
              <button class="va-btn" id="va-clip-in" onclick="vaSetClipPoint('in')">ğŸŸ¢ IN</button>
              <button class="va-btn" id="va-clip-out" onclick="vaSetClipPoint('out')">ğŸ”´ OUT</button>
            </div>
            <button class="va-btn va-btn-teal" id="va-save-clip" onclick="vaSaveClip()"
              style="width:100%;margin-bottom:12px;display:none">âœ‚ï¸ Guardar clip</button>

            <p class="va-label">Guardados (<span id="va-clip-count">0</span>)</p>
            <div id="va-clip-list">
              <div class="va-empty">Marca IN y OUT para crear clips.</div>
            </div>
          </div>
        </div>

        <div class="va-hints">
          <span><kbd>Espacio</kbd> Play</span>
          <span><kbd>â†â†’</kbd> Â±5s</span>
          <span><kbd>,.</kbd> Frame</span>
          <span><kbd>1-9</kbd> AcciÃ³n</span>
          <span><kbd>Enter</kbd> AÃ±adir</span>
          <span><kbd>Ctrl+Z</kbd> Deshacer</span>
          <span><kbd>Esc</kbd> Salir</span>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="js/videoanalisis.js"></script>
</body>
</html>
